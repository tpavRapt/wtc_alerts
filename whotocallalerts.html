<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick Who-To-Call</title>

    <!-- ===============================================-->
    <!--    Stylesheets                                 -->
    <!-- ===============================================-->
    
    <link rel="stylesheet" href="01jquery.dataTables.min.css">
    <link rel="stylesheet" href="02responsive.dataTables.min.css">
    <link rel="stylesheet" href="03.icons.css">
    <link rel="stylesheet" href="04all.min.css">
    <link rel="stylesheet" href="05theme.min.css" type="text/css" id="style-default">
    <link rel="stylesheet" href="06raptor.css" type="text/css" >
    <!-- ADD THIS: Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Use LokiJS from CDN instead of local file -->
    <script src="https://cdn.jsdelivr.net/npm/lokijs@1.5.12/build/lokijs.min.js"></script>
    <script src="01jquery-3.6.0.min.js"></script>
    <script src="02jquery.dataTables.min.js"></script>
    <script src="03dataTables.responsive.min.js"></script>
    <script src="04config.js"></script>
    <script src="05classes.js"></script>
    <script src="06raptor.js"></script>
    <!-- ADD THIS: Bootstrap 5 JS (after jQuery, before your custom scripts if any depend on Bootstrap) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</head>
<body>
    <!-- ===============================================-->
    <!--    Main Content-->
    <!-- ===============================================-->
    <main class=" card-body main">
        <div class="card h-100">
          <div class="card-body">
            <div class="pb-0 pt-4">
              <ul class="nav nav-underline fs-9" id="myTab" role="tablist">
                <li class="nav-item" role="presentation"><a class="nav-link active" id="home-tab" data-bs-toggle="tab" href="#tab-home" role="tab" aria-controls="tab-home" aria-selected="true">New Alerts</a></li>
                <li class="nav-item" role="presentation"><a class="nav-link" id="profile-tab" data-bs-toggle="tab" href="#tab-profile" role="tab" aria-controls="tab-profile" aria-selected="false" tabindex="-1">Historical Alerts</a></li>
              </ul>
              <div class="tab-content mt-3" id="myTabContent">
                <div class="tab-pane fade show active" id="tab-home" role="tabpanel" aria-labelledby="home-tab">
                  <div id="tableNew" data-list="">
                    <div class="table-responsive">                     
                      <table id="messagesTable" class="table table-dark table-striped table-hover table-bordered align-middle mb-0" style="width:100%">
                            <thead class="table-dark">
                                <tr>
                                    <th></th>
                                    <th>MessageID</th>
                                    <th>Client</th>
                                    <th>Reason</th>
                                    <th>Alert Status</th>
                                    <th>RefTierMessageID</th>
                                    <th>RefMessageID</th>
                                    <th>IOI Symbol</th>
                                    <th>MessageID</th>
                                    <th>IOI Shares</th>
                                    <th>Opportunity to</th>
                                    <th>When</th>
                                    <th>HoldingsRefAccountID</th>
                                    <th>News</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                  </div>
                </div>
                <!-- Table NEW -->
                <!-- Table ACKED -->
                <div class="tab-pane fade" id="tab-profile" role="tabpanel" aria-labelledby="profile-tab">
                  <div id="tableHistoric" data-list="">
                    <div class="table-responsive">
                      <table id="messagesTableHistoric" class="table table-dark table-striped table-hover table-bordered align-middle mb-0" style="width:100%">
                            <thead class="table-dark">
                                <tr>
                            <!--th class="sort border-top border-translucent ps-3" data-sort="name">Time</th-->
                            <!--th class="sort border-top border-translucent ps-3" data-sort="name">Type</th-->
                            <!--th class="sort border-top border-translucent" data-sort="symbol">Symbol</th-->
                            <!--th class="sort border-top border-translucent" data-sort="client">Client</th-->
                            <!--th class="sort border-top border-translucent text-end pe-3" data-sort="Status">Status</th-->
                                    <th></th>
                                    <th>MessageID</th>
                                    <th>Client</th>
                                    <th>Reason</th>
                                    <th>Alert Status</th>
                                    <th>RefTierMessageID</th>
                                    <th>RefMessageID</th>
                                    <th>IOI Symbol</th>
                                    <th>MessageID</th>
                                    <th>IOI Shares</th>
                                    <th>Opportunity to</th>
                                    <th>When</th>
                                    <th>HoldingsRefAccountID</th>
                                    <th>News</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>

      <!-- LokiJS DB Viewer Button and Modal -->
      <button id="showLokiDbBtn" class="btn btn-secondary shadow" style="position:fixed;bottom:24px;right:24px;z-index:9999;border-radius:50%;width:56px;height:56px;display:flex;align-items:center;justify-content:center;font-size:22px;">
        <i class="fa fa-database"></i>
      </button>
      <div id="lokiDbModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:10000;backdrop-filter:blur(6px);background:rgba(20,22,30,0.75);transition:background 0.3s;">
        <div style="background:#23272f;color:#f8f9fa;max-width:700px;width:90vw;max-height:80vh;overflow:auto;margin:60px auto 0 auto;padding:32px 28px 20px 28px;border-radius:18px;box-shadow:0 8px 32px 0 rgba(0,0,0,0.45);position:relative;animation:fadeInModal 0.25s;">
          <button id="closeLokiDbModal" class="btn btn-outline-light btn-sm" style="position:absolute;top:18px;right:18px;border-radius:50%;width:32px;height:32px;display:flex;align-items:center;justify-content:center;font-size:18px;">
            <i class="fa fa-times"></i>
          </button>
          <h4 style="margin-bottom:18px;font-weight:600;letter-spacing:0.5px;">LokiJS Messages Collection</h4>
          <pre id="lokiDbContent" style="background:#181b20;color:#7fffd4;font-size:15px;line-height:1.6;padding:18px 14px 18px 18px;border-radius:8px;overflow:auto;box-shadow:0 2px 8px rgba(0,0,0,0.12);max-height:55vh;"></pre>
        </div>
      </div>
      <style>
      @keyframes fadeInModal {
        from { opacity: 0; transform: translateY(30px);}
        to   { opacity: 1; transform: translateY(0);}
      }
      #lokiDbModal {
        transition: background 0.3s;
      }
      #lokiDbModal[style*="display: block"] > div {
        animation: fadeInModal 0.25s;
      }
      #showLokiDbBtn:hover {
        background: #343a40;
        color: #7fffd4;
        box-shadow: 0 4px 16px rgba(0,0,0,0.18);
      }
      #closeLokiDbModal:hover {
        background: #7fffd4;
        color: #23272f;
      }
      @media (max-width: 600px) {
        #lokiDbModal > div {
          padding: 16px 6px 12px 10px !important;
          max-width: 98vw !important;
        }
        #lokiDbContent {
          font-size: 12px !important;
          padding: 8px 4px 8px 8px !important;
        }
      }

      /* Bootstrap-based DataTable tweaks for #messagesTable */
      #messagesTable th, #messagesTable td {
        vertical-align: middle;
        padding: 0.55rem 0.75rem;
        font-size: 0.97rem;
      }
      #messagesTable thead th {
        background: #23272f;
        color: #7fffd4;
        border-bottom: 2px solid #343a40;
        font-weight: 600;
        letter-spacing: 0.03em;
      }
      #messagesTable tbody tr {
        background: #181b20;
        color: #f8f9fa;
      }
      #messagesTable tbody tr:hover {
        background: #23272f;
      }
      #messagesTable td, #messagesTable th {
        border-color: #343a40 !important;
      }
      #messagesTable .badge, #messagesTable .badge-link {
        font-size: 0.85em;
        padding: 0.3em 0.7em;
        border-radius: 0.4em;
      }
      #messagesTable .badge-news {
        background: #198754;
        color: #fff;
      }
      #messagesTable .details-control {
        cursor: pointer;
        text-align: center;
        width: 32px;
      }
      @media (max-width: 900px) {
        #messagesTable th, #messagesTable td {
          font-size: 0.89rem;
          padding: 0.35rem 0.5rem;
        }
      }
      </style>

      <script>
        // For window.onload function see end of 06raptor.js

        document.getElementById('showLokiDbBtn').onclick = function() {
          // Wait for LokiJS and messagesCollection to be available
          if (window.messagesCollection) {
            var data = window.messagesCollection.find();
            document.getElementById('lokiDbContent').textContent = JSON.stringify(data, null, 2);
          } else {
            document.getElementById('lokiDbContent').textContent = 'messagesCollection not available.';
          }
          document.getElementById('lokiDbModal').style.display = 'block';
        };

        document.getElementById('closeLokiDbModal').onclick = function() {
          document.getElementById('lokiDbModal').style.display = 'none';
        };

        // Optional: close modal on background click
        document.getElementById('lokiDbModal').onclick = function(e) {
          if (e.target === this) this.style.display = 'none';
        };
      </script>
</body>
</html>
